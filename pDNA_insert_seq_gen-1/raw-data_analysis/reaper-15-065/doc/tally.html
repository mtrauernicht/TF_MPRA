<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Copyright (c) 2015 Stijn van Dongen -->
<head>
<meta name="keywords" content="deduplication of sequence fragments">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<style type="text/css">
.slartibartfast { background-color: pink; text-decoration: blink; }

   /* open base2 */
/* start aephea.base.css */

   body
      {  text-align: justify;
         margin-left: 0%;
         margin-right: 0%;
      }

   a:link            { text-decoration: none; }
   a:active          { text-decoration: none; }
   a:visited         { text-decoration: none; }

   a:link            { color: #1111aa; }
   a:active          { color: #1111aa; }
   a:visited         { color: #111166; }
   a.local:link      { color: #11aa11; }
   a.local:active    { color: #11aa11; }
   a.local:visited   { color: #116611; }
   a.intern:link     { color: #1111aa; }
   a.intern:active   { color: #1111aa; }
   a.intern:visited  { color: #111166; }
   a.extern:link     { color: #aa1111; }
   a.extern:active   { color: #aa1111; }
   a.extern:visited  { color: #661111; }
   a.quiet:link      { color: black; }
   a.quiet:active    { color: black; }
   a.quiet:visited   { color: black; }

   p.asd_par         {  margin-bottom:0em }
   p.asd_cpar        {  margin-bottom:0em }
   span.asd_cpar_caption  {  font-weight: bold; display: block }

   p.asd_car         {  margin-top:0em; margin-bottom:0em }
   p.asd_ccar        {  margin-top:0em; margin-bottom:0em }
   span.asd_ccar_caption  {  font-weight: bold; display: block }

   div.verbatim
      {  font-family: monospace;
         margin-top: 1em;
         margin-bottom: 1em;
         font-size: 10pt;
         margin-left: 2em;
         white-space: pre;
      }

   div.indent
      {  margin-left: 8%;
         margin-right: 0%;
      }

   .right   { text-align: right; }
   .left    { text-align: left; }
   .nowrap  { white-space: nowrap; }

   .item_leader 
      {  position: relative;
         margin-left: 8%;
      }
   
   .item_compact     {  position: absolute; vertical-align: baseline; }
   .item_cascade     {  position: relative; }

   .item_leftalign   {  text-align: left; }

   .item_rightalign
      {  width: 2em;
         text-align: right;
      }
   .item_compact .item_rightalign
      {  position: absolute;
         width: 52em;
         right: -2em;
         text-align: right;
      }

   .item_text
      {  position: relative;
         margin-left: 3em;
      }  

   .smallcaps { font-size: smaller; text-transform: uppercase }
   .underline { text-decoration: underline }

   acronym.ucase { font-size: smaller; text-transform: uppercase }
   abbr.ucase { font-size: smaller; text-transform: uppercase }

/* end aephea.base.css */
/* close base2 */
/* open simpledocument2 */
/* start aephea.asd.css */

   body {
      margin:0px;
      padding:0px;
      border: 0px;
   }


   .sec_leader
      {  margin-top: 1em;
         margin-bottom: 0em;
         position: relative;
         right: 0px;
         left: 0px;
         top: 0px;
      }

   .sec_title
      {  color: black;
         position: relative;
         margin-bottom: 0px;
         margin-top: 0px;
         margin-right: 5em;
         margin-left: 5em;
         text-align: center
      }

   .sec_num
      {  color: black;
         position: absolute;
         right: 0px;
         text-align: right;
         width: 5em;
         top: 0px;
      }

   .sec_lev1 { font-size: 20px; }
   .sec_lev2 { font-size: 18px; }
   .sec_lev3 { font-size: 16px; }
   .sec_lev4 { font-size: 14px; }
   .sec_lev5 { font-size: 12px; }
   .sec_lev6 { font-size: 12px; }

   .toc_toplevel
      {  margin-top: 1em;
      }

   .toc_leader
      {  margin-top: 0em;
         margin-bottom: 0em;
         position: relative;
         right: 0px;
         left: 0px;
      }

   .toc_title { position: relative; }

   .toc_num
      {  position: absolute;
         text-align: left;
         top: 0px;
         left: 0px;
      }

   .toc_title1 { margin-left: 3em; }
   .toc_title2 { margin-left: 6em; }
   .toc_title3 { margin-left: 9em; }
   .toc_title4 { margin-left: 12em; }

   .toc_num1   { left: 1em; }
   .toc_num2   { left: 3em; }
   .toc_num3   { left: 6em; }
   .toc_num4   { left: 9em; }

   div.box { border:solid; border-width:thin; width:100%; padding:1em}
   div.flushright { text-align: right }

/* end aephea.asd.css */
/* close simpledocument2 */
/* open css_append */

      

      body { font-family: "Verdana", "Garamond", "Gill Sans", "Verdana", sans-serif; }

      body
         {  text-align: justify;
            font-size: 10pt;
            margin-left: 8%;
            margin-right: 8%;
         }

      .asd_title
         {  text-align: center;
            font-size: 40px;
            margin-top: 4em;
         }

      .asd_subtitle
         {  text-align: center;
            font-size: 25px;
            margin-top: 1em;
            margin-bottom: 2em;
         }

/* aephea general hooks: */

      #asd_leftcolumn {
         position: fixed;
         text-align: left;
width: 300px;
overflow: auto;
         left: 0px; top: 0px; bottom: 0px;

         background-color: #ffbb66;
         border-right:6px solid DarkBlue;
   z-index: 138;
      }

      #asd_document_outer {
         position: absolute;
         top: 0px;
left: 300px;
width: 800px;
         border-right:6px solid #ffbb66;
      }

      #asd_document {
         width: 700px;
         overflow: visible;
         margin: 40px auto;
   z-index: 137;
      }

      #asd_toc {
width: 280px;
margin: 50px auto;
         background-color: #ffbb66;
      }

      .asd_date {
         position: absolute;
         right: 20px;
         top: 20px;
      }

      .asd_version {
         position: absolute;
         left: 26px;
         top: 20px;
      }

      .recipe {
         width: 660px;
         overflow: auto;
         border: 3px solid red;
         padding: 1em;

         margin-top: 1em;
         margin-bottom: 1em;
         font-size: 10pt;
         margin-left: 1ex;
         font-family: courier;
         white-space: pre;
      }

      .wordlist   {  font-size: 121%; font-style: italic; }
      .namelist   {  font-size: 121%; }
      .example    {  margin-left: 2em; }
      .sec_title  {  text-align: left; margin-left: 0em; }
      .sec_lev1   {  font-size: 30px; }
      .sec_lev2   {  font-size: 25px; }
      .sec_lev3   {  font-size: 20px; }
      .toc_and_date_TOC a.intern { visibility: hidden; }
      .sec_num    {  display: auto; }
      .quote_attribution {  text-align: right; font-size: smaller; }
      .smallcaps  {  font-size: smaller; text-transform: uppercase }
                               /* .smallcaps  {  font-variant: small-caps } */

      .verbatim {
         margin-top: 1em;
         margin-bottom: 1em;
         font-size: 10pt;
         margin-left: 2em;
         font-family: courier;
         white-space: pre;
      }

      acronym.ucase, abbr.ucase {
         font-size: smaller;
         text-transform: uppercase;
         text-decoration: none;
         border-style: none;
      }


   
/* close css_append */
</style>
<title>Tally</title>
</head>
<body>
<div id=asd_leftcolumn>
<div id=asd_toc>
<div class="toc_toplevel">
<a name="thetoc"></a>
<div class="toc_leader">
<div class="toc_num toc_num1"><a class="intern" href="#asd_body_start">Start</a>.</div>
<div class="toc_title toc_title1"><a name="toc_asd_body_start"></a><a class="intern" href="#asd_body_start">&nbsp;</a></div>
</div>
<div class="toc_leader">
<div class="toc_num toc_num1"><a name="toc1">1</a>.</div>
<div class="toc_title toc_title1"><a name="toc_syn"></a><a class="intern" href="#syn">Synopsis</a></div>
</div>
<div class="toc_leader">
<div class="toc_num toc_num1"><a name="toc2">2</a>.</div>
<div class="toc_title toc_title1"><a name="toc_description"></a><a class="intern" href="#description">Description</a></div>
</div>
<div class="toc_leader">
<div class="toc_num toc_num1"><a name="toc3">3</a>.</div>
<div class="toc_title toc_title1"><a name="toc_pe"></a><a class="intern" href="#pe">Paired end read processing</a></div>
</div>
<div class="toc_leader">
<div class="toc_num toc_num1"><a name="toc4">4</a>.</div>
<div class="toc_title toc_title1"><a name="toc_ex"></a><a class="intern" href="#ex">Examples</a></div>
</div>
<div class="toc_leader">
<div class="toc_num toc_num1"><a name="toc5">5</a>.</div>
<div class="toc_title toc_title1"><a name="toc_at"></a><a class="intern" href="#at">Author/contact</a></div>
</div>
<div class="toc_leader">
<div class="toc_num toc_num1"><a class="intern" href="#asd_body_end">End</a>.</div>
<div class="toc_title toc_title1"><a name="toc_asd_body_end"></a><a class="intern" href="#asd_body_end">&nbsp;</a></div>
</div>
</div>
</div>
</div>
<div id=asd_document_outer>
<a name="asd_body_start"></a>
<div id=asd_document>
<div class="asd_date">April 17, 2015</div>
<div class="asd_version">tally-15-065
</div>
<div class="asd_title">Tally</div>
<div class="asd_subtitle">Deduplication of sequence fragments</div>

<a name="syn"></a><div class="sec_leader sec_lev1"><div class="sec_title"><a class="intern" href="#syn">Synopsis</a></div><div class="sec_num"><a class="intern" href="#toc1"><span class="sec_num">1</span></a></div></div>
<p class="asd_par">
Tally is a program for deduplicating sequence fragments. It minimises memory
usage by compressing sequences and using compact memory allocation
techniques. A built-in parser allows a variety of input file formats and a
simple specification language allows flexible output file formats.
It can be made aware of paired-end reads, and it can handle degenerate sequence
inserts intended to reveal amplification biases.
Tally comes with <a class="local" href="reaper.html"><i>reaper</i></a>, a program for demultiplexing,
trimming and filtering short read sequencing data.
</p>

<a name="description"></a><div class="sec_leader sec_lev1"><div class="sec_title"><a class="intern" href="#description">Description</a></div><div class="sec_num"><a class="intern" href="#toc2"><span class="sec_num">2</span></a></div></div>
<div class=" itemize " style="margin-top:1em; margin-left:0em; font-size:100%">
<div style="position:relative; margin-top:0em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<p class="asd_car">
In its simplest form <i>tally</i> usage is as follows.
This example uses as example input file name (the argument to the <tt>-i</tt> option)
the default <i>reaper</i> output name.
</p>
<div class="verbatim">   tally -i out.lane.clean.gz -o out.lane.unique.gz</div>
<p class="asd_car">
By default <i>tally</i> writes gzipped files. It is possible to prevent this using the <tt>--nozip</tt> option.
</p>
<div class="verbatim">   tally -i out.lane.clean.gz -o out.lane.unique --nozip</div>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<p class="asd_car">
By default <i>tally</i> expects <span class="smallcaps">FASTQ</span> format.
Other formats can be specified using the <tt>-record-format</tt> option (refer
to <a class="intern" href="#ex">Examples</a>).
When processing paired-end files with <i>reaper</i> and <i>tally</i>, the easiest approach is
to use the <i>reaper</i> <tt>--fastqx-out</tt> option and the <i>tally</i> <tt>--fastqx-in</tt> option.
</p>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<p class="asd_car">
It is possible to retain quality
information by supplying the <tt>--with-quality</tt> option. Tally will then
keep track of read quality; for redundant (identical) reads it will, for a
given base, keep the best quality score for that base among the reads.
</p>
<p class="asd_par">
<i>Note that retaining quality increases the memory requirements
approximately fivefold.</i> This substantial increase is due to the fact
that quality scores are stored in raw form. Sequences are stored in compressed format
making <i>tally</i> very memory-efficient if quality does not need to be tracked.
</p>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<p class="asd_car">
By default tally will try to set parameters automatically by inspecting
the input file. This requires that the input file is searchable, i.e.
not streamed via a pipe.
This automatic behaviour can be turned off using the option <tt>--no-auto</tt>.
It is possible to obtain a <i>rough</i> estimate of memory usage using <tt>--peek</tt>.
</p>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<p class="asd_car">
Tally can read paired end samples. Refer to sections <a class="intern" href="#pe">Paired end read processing</a>
and <a class="intern" href="#ex">Examples</a>.
</p>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<p class="asd_car">
Tally can tally already counted reads, meaning that it can read in counts associated
with reads. This requires usage of the <tt>-record-format</tt> option and the <tt>%X</tt>
directive (see <a class="intern" href="#ex">Examples</a>).
</p>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<p class="asd_car">
Tally can read a variety of formats. The input syntax can be described
with the <tt>-record-format</tt> option, accepting a syntax nearly
identical to the identically named <i>reaper</i> option.
It should be noted that <i>tally</i> assigns <i>meaning</i> to very few fields.
These are the read itself (<tt>%R</tt>), a count associated with the read (<tt>%X</tt>),
a record offset (<tt>%J</tt> &mdash; required when processing paired files)
and a string identifier for paired-end safety checking (<tt>%I</tt> &mdash; refer to <a class="intern" href="#pe">Paired end read processing</a>).
</p>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<p class="asd_car">
Tally can handle degenerate sequence inserts. The <tt>-dsi</tt>&nbsp;<tt>&lt;num&gt;</tt> option
causes <i>tally</i> to strip the first <tt>&lt;num&gt;</tt> bases from the read upon output.
The output may thus still contain duplicated fragments; these are informative
for amplification biases.
</p>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<p class="asd_car">
Tally generates summary statistics on the number of reads
read and produced. By default these are sent to
the diagnostic stream. It is possible to redirect them to file
by using the <tt>-sumstat</tt>&nbsp;<tt>&lt;file-name&gt;</tt> option.
</p>
</div>
</div>

<a name="pe"></a><div class="sec_leader sec_lev1"><div class="sec_title"><a class="intern" href="#pe">Paired end read processing</a></div><div class="sec_num"><a class="intern" href="#toc3"><span class="sec_num">3</span></a></div></div>
<p class="asd_par">
Tally supports paired end read processing in the following two scenarios.
In the simplest case it is assumed that two sample files with the same number
of reads are provided. Reads at identical offsets in the respective
files correspond to paired ends. In this scenario the user need only
specify the extra input file with the <tt>-j</tt>&nbsp;option and the extra output
file with the <tt>-p</tt>&nbsp;option.
</p>
<p class="asd_par">
In the more involved case the paired files are processed with <i>reaper</i>
or another program, and after processing the implicit record-by-record or line-by-line
correspondence between the files may be lost. It is then neceessary that
record offset information is attached to the records. This will be used by <i>tally</i>
to pair up records.
The <i>reaper</i> program can be instructed to include offset information
with the <tt>--fastqx-out</tt> option.
Tally can be instructed to read this format by giving it the <tt>--fastqx-in</tt> option.
Alternatively custom formats can be created with the <i>reaper</i> output <tt>-format-clean</tt> option and
the <i>tally</i> input option <tt>-record-format</tt>. These must be matched and use
the record-offset encoding <tt>%J</tt> directive.
The reason for using record offset numbers as identifiers is that a numerical
and increasing identifier can be used to efficiently pair reads from different files.
</p>
<p class="asd_par">
If <i>tally</i> is instructed to parse <span class="smallcaps">FASTQ</span> identifiers (this is the
case when using <tt>--fastqx-in</tt> for example)
it will check whether identifiers are identical for paired reads.
The number of non-matching identifiers is reported after processing.
</p>
<p class="asd_par">
Paired end processing is enabled
by supplying <i>tally</i> with two input file names as arguments to the <tt>-i</tt>
and <tt>-j</tt> options.
When processing paired end reads output can be sent to a single file or
to two files. To send output to a single file just use the <tt>-o</tt> file output option,
the <tt>-format</tt> option and <tt>%A</tt> and <tt>%B</tt> directives for the
first, respectively second fragment.
To send output to two files, additionally use the <tt>-p</tt> file output
option. In this case, the <tt>%R</tt> directive becomes context aware. It refers
to the first fragment when outputting to the first file (specified by <tt>-o</tt>)
and to the second fragment when outputting to the second file (specified by <tt>-p</tt>).
</p>

<a name="ex"></a><div class="sec_leader sec_lev1"><div class="sec_title"><a class="intern" href="#ex">Examples</a></div><div class="sec_num"><a class="intern" href="#toc4"><span class="sec_num">4</span></a></div></div>
<div class=" itemize " style="margin-top:2em; margin-left:0em; font-size:100%">
<div style="position:relative; margin-top:0em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<span style="font-size:larger; background-color:beige; border-radius: 5px; padding: 2px 8px;">Baseline tally invocation, <span class="smallcaps">FASTQ</span> input and output</span>
<div class="verbatim">tally -i out.lane.clean.gz -o out.lane.unique.gz</div>
<p class="asd_car">The first three records will look similar to this:</p>
<div class="verbatim">@trn_1      31874
TAGCTTATCAGACTGATGTTGAC
+
~~~~~~~~~~~~~~~~~~~~~~~
@trn_2      26764
ACTCAAACTGGGGGCTCTTTT
+
~~~~~~~~~~~~~~~~~~~~~
@trn_3      11866
AGTGCCGCAGAGTTTGTAGTGT
+
~~~~~~~~~~~~~~~~~~~~~~</div>
<p class="asd_car">
Note that <span class="smallcaps">FASTQ</span> identifiers have disappeared. The output identifiers are
formed by the fixed string <tt>trn</tt> (for <i>tally record number</i>) followed by
the output record number. The number of times a read was observed is specified
on the identifier line as the second field.
</p>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<span style="font-size:larger; background-color:beige; border-radius: 5px; padding: 2px 8px;">Changing the output format</span>
<p class="asd_par">A simple line-based format can be obtained using e.g. <tt>-format&nbsp;'%R%t%X%n'</tt>.
The output (containing reads and their counts) will look like this:
</p>
<div class="verbatim">TAGCTTATCAGACTGATGTTGAC 31874
ACTCAAACTGGGGGCTCTTTT   26764
AGTGCCGCAGAGTTTGTAGTGT  11866</div>
<p class="asd_car">The set of supported directives available to the <tt>-format</tt> option is this:</p>
<div class="verbatim">%R  read
%L  length
%C  number of occurrences
%X  number of occurrences
%T  trinucleotide score
%I  read identifier - numerical identifier constructed on output
%t  tab
%n  newline
%%  percentage character</div>
<p class="asd_par">To obtain <span class="smallcaps">FASTA</span> output, use <tt>--fasta-out</tt>.
</p>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<span style="font-size:larger; background-color:beige; border-radius: 5px; padding: 2px 8px;">Changing the input format</span>
<p class="asd_par">
<span class="smallcaps">FASTA</span> format can be read using the <tt>--fasta-in</tt> option.
Other formats can be read using the <tt>-record-format</tt> option
(see <a class="intern" href="#ex">Examples</a>).
</p>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<span style="font-size:larger; background-color:beige; border-radius: 5px; padding: 2px 8px;">Reading in counted data</span>
<p class="asd_par">
Tally can read in data that is already counted. This requires usage of
<tt>-record-format</tt> and the <tt>%X</tt> directive. To read in a simple two-field
line-based format consisting of read and count one would use:
</p>
<div class="verbatim">-record-format '%R%b%X%n'</div>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<span style="font-size:larger; background-color:beige; border-radius: 5px; padding: 2px 8px;">Retaining quality</span>
<p class="asd_par">To retain quality information, use <tt>--with-quality</tt>. Memory usage
will increase approximately five-fold.
For each base the best quality score is recorded.
Example output:
</p>
<div class="verbatim">@trn_1  31874
TAGCTTATCAGACTGATGTTGAC
+
&gt;AAAAAAAAA&gt;AA&gt;?&gt;&gt;&gt;??&gt;&gt;&gt;
@trn_2  26764
ACTCAAACTGGGGGCTCTTTT
+
AAAAAAAAAAAAAAA&gt;&gt;&gt;&gt;&gt;&gt;
@trn_3  11866
AGTGCCGCAGAGTTTGTAGTGT
+
AAAAAAAAAAAAA?A&gt;&gt;&gt;&gt;&gt;&gt;&gt;</div>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<span style="font-size:larger; background-color:beige; border-radius: 5px; padding: 2px 8px;">Re-pairing and tallying reaper-processed paired-end files</span>
<p class="asd_par">
In this scenario it is assumed that each of the paired files
was processed independently by <i>reaper</i>, and as a result the record offset correspondence
between the two files is lost.
The invocation below assumes <i>reaper</i> was given the <tt>--fastqx-out</tt> option.
This causes the introduction of an additional field on the identifier line
containing the record offset number, allowing <i>tally</i> to pair up the two files.
Options such as <tt>--with-quality</tt> can be given additionally.
</p>
<div class="verbatim">tally -i out1.gz -j out2.gz -o out1.unique.gz -p out2.unique.gz --fastqx-in</div>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<span style="font-size:larger; background-color:beige; border-radius: 5px; padding: 2px 8px;">Re-pairing reaper-processed files without tallying</span>
<p class="asd_par">
In this scenario identical reads will not be collapsed.
This simply requires the use of the <tt>--no-tally</tt> option.
<i>Please note that tally will in this case output the identifiers found
in the input file.</i>
Options such as <tt>--with-quality</tt> can be given additionally.
</p>
<div class="verbatim">tally -i out1.gz -j out2.gz -o out1.unique.gz -p out2.unique.gz --fastqx-in --no-tally</div>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<span style="font-size:larger; background-color:beige; border-radius: 5px; padding: 2px 8px;">Tallying implicitly paired files</span>
<p class="asd_par">
In this scenario two files are implicitly paired, such as is
the case for unprocessed paired-end <span class="smallcaps">FASTQ</span> files.
Tally will process both files record-by-record and pair up
records at the same offset. This requires the option <tt>--pair-by-offset</tt>.
</p>
<div class="verbatim">tally -i out1.gz -j out2.gz -o out1.unique.gz -p out2.unique.gz --pair-by-offset</div>
</div>
<div style="position:relative; margin-top:1em"><div class=" item_compact"><div class=" item_rightalign "
style="right:-1em"><span class="itembullet">&bull;</span></div></div></div>
<div class=" item_text " style="margin-left:2em">
<span style="font-size:larger; background-color:beige; border-radius: 5px; padding: 2px 8px;">Re-pairing files in other formats</span>
<p class="asd_par">
This can be achieved only if the record format can be recognised by
the <tt>-record-format</tt> specification language, and requires the presence
of a record offset field in the record format. This field can be read using
the <tt>%J</tt> directive.
The specification language is documented below.
</p>
<div class="verbatim">     %R  expect read (longest sequence found over [a-zA-Z]*) - empty read allowed
     %J  expect record offset (integer)
     %I  expect identifier (longest sequence of non-blank)
     %Q  expect quality (longest sequence of non-blank)
     %X  expect count (a nonnegative integer number)
     %F  expect and discard field (longest sequence of non-tab)
     %G  expect and discard field (longest sequence of non-blank)
     %#  discard everything until end of line
     %b  expect run of blanks (space or tab)
     %n  expect end of line match
     %.  expect and discard any character
     %s  expect a space
     %t  expect a tab
     %%  expect a percent sign</div>
<p class="asd_car">
The directives listed above are all placeholders that will be filled by
<i>tally</i> with the appropriate character or field. All such placeholders
start with a percent sign (<tt>%</tt>). Anything that is not a placeholder
will be copied verbatim.
An example is the standard count-extended <span class="smallcaps">FASTQ</span> format output by <i>reaper</i>
when using <tt>--fastqx-out</tt>) and expected by <i>tally</i> (using <tt>--fastqx-in</tt>.
It corresponds to:
</p>
<div class="verbatim">-record-format '@%I%brecno=%J%#%R%n+%n%Q%n'</div>
</div>
</div>

<a name="at"></a><div class="sec_leader sec_lev1"><div class="sec_title"><a class="intern" href="#at">Author/contact</a></div><div class="sec_num"><a class="intern" href="#toc5"><span class="sec_num">5</span></a></div></div>
<p class="asd_par">
Tally was written by Stijn van Dongen and benefited greatly from suggestions
by Anton Enright, Mat Davis, Sergei Manakhov, Nenad Bartonicek and Leonor Quintais.
For questions and feedback send e-mail
to&nbsp;&nbsp;<tt>kraken&nbsp;&#x0040;&nbsp;ebi&nbsp;&#x002E;&nbsp;ac&nbsp;&#x002E;&nbsp;uk</tt>.
</p>
<a name="asd_body_end"></a>
</div></div>
</body>
</html>
